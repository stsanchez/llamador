<!DOCTYPE html>
<html>
<head>
    <title>Notificador</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: #f0f4f8;
            color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            overflow: hidden;
        }
        #container {
            display: flex;
            width: 100%;
            height: calc(100% - 50px); /* Ajustar para dejar espacio para el botón */
            max-width: 1200px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            overflow: hidden;
            background-color: #fff; /* Fondo blanco para el contenedor */
        }
        #header {
            width: 100%;
            background-color: #fff; /* Fondo blanco para el header */
            display: flex;
            justify-content: center;
            padding: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        #logo {
            max-height: 60px; /* Ajusta la altura del logo según sea necesario */
        }
        #patient-list {
            flex: 1;
            padding: 20px;
            border-right: 2px solid #ddd;
            box-sizing: border-box;
            background-color: #fff;
        }
        #patient-list h2 {
            margin-top: 0;
            color: #007BFF;
        }
        #patients {
            list-style: none;
            padding: 0;
        }
        #patients li {
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 4px;
            background-color: #e9ecef;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        #notifications {
            flex: 2;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #fff;
            overflow-y: auto;
        }
        .notification {
            background-color: #28a745;
            color: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            width: 80%;
            text-align: center;
            font-size: 1.2em;
            display: none; /* Ocultar inicialmente */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            animation: fadeInOut 10s ease-out;
        }
        @keyframes fadeInOut {
            0% { opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { opacity: 0; }
        }
        #enable-sound {
            position: fixed;
            bottom: 10px;
            right: 10px;
            padding: 5px 10px;
            font-size: 0.8em;
            background-color: #007BFF;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        #enable-sound:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <div id="header">
        <img id="logo" src="logo_emer.jpeg" alt="Logo de la Empresa">
    </div>
    <div id="container">
        <div id="patient-list">
            <h2>En espera</h2>
            <ul id="patients"></ul>
        </div>
        <div id="notifications"></div>
    </div>

    <audio id="notification-sound" src="msnalert.mp3" preload="auto"></audio>
    <button id="enable-sound">Habilitar sonido</button>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const socket = io();
            const notificationsContainer = document.getElementById('notifications');
            const patientsList = document.getElementById('patients');
            const notificationSound = document.getElementById('notification-sound');
            const enableSoundButton = document.getElementById('enable-sound');

            // Manejar la lista de pacientes
            fetch('/pacientes')
                .then(response => response.json())
                .then(data => {
                    data.forEach(patient => {
                        const li = document.createElement('li');
                        li.setAttribute('data-id', patient.id); // Agregar ID como atributo
                        li.textContent = `${patient.nombre} ${patient.apellido}`;
                        patientsList.appendChild(li);
                    });
                });

            // Manejar la notificación de llamada
            socket.on('llamada', (data) => {
                // Crear un nuevo elemento de notificación
                const notificationElement = document.createElement('div');
                notificationElement.classList.add('notification');
                notificationElement.textContent = `${data.nombre} ${data.apellido}: consultorio 3`;
                notificationsContainer.prepend(notificationElement);
                notificationElement.style.display = 'block';

                // Reproducir el sonido de notificación
                if (notificationSound.dataset.enabled === 'true') {
                    notificationSound.play().catch(error => {
                        console.error('Error al reproducir el sonido:', error);
                    });
                }

                // Limitar a un máximo de 5 notificaciones
                if (notificationsContainer.children.length > 5) {
                    notificationsContainer.removeChild(notificationsContainer.lastChild);
                }

                // Eliminar al paciente de la lista de espera
                const patientItems = patientsList.querySelectorAll('li');
                patientItems.forEach(item => {
                    if (item.textContent.includes(`${data.nombre} ${data.apellido}`)) {
                        patientsList.removeChild(item);
                    }
                });
            });

            // Habilitar el sonido
            enableSoundButton.addEventListener('click', () => {
                notificationSound.play().then(() => {
                    notificationSound.dataset.enabled = 'true';
                }).catch(error => {
                    console.error('Error al habilitar el sonido:', error);
                });
            });
        });
    </script>
</body>
</html>
